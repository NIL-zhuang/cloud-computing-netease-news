<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新闻发布时间分布表</title>
</head>

<body>
    <div id="container"></div>
    <script src="https://gw.alipayobjects.com/os/lib/antv/g2/4.0.15/dist/g2.min.js"></script>
    <script>
        window.onload = function () {
            let url = "../../data/news.json";
            let request = new XMLHttpRequest();
            request.open("get", url);
            request.send(null);
            request.onload = function () {
                if (request.status === 200) {
                    // 解析 raw json
                    fakeJsonStr = request.responseText;
                    let strArray = fakeJsonStr.split('}{');
                    let realJsonStr = "[" + strArray[0];
                    for (let i = 1; i < strArray.length; i++) {
                        realJsonStr = realJsonStr + "}, {" + strArray[i];
                    }
                    realJsonStr += "]";
                    let jsonData = JSON.parse(realJsonStr);
                    console.log(jsonData);

                    const data = [
                        { "time": '11-25', "type": '0:00-1:00', "value": 0 },
                        { "time": '11-25', "type": '1:00-2:00', "value": 0 },
                        { "time": '11-25', "type": '2:00-3:00', "value": 0 },
                        { "time": '11-25', "type": '3:00-4:00', "value": 0 },
                        { "time": '11-25', "type": '4:00-5:00', "value": 0 },
                        { "time": '11-25', "type": '5:00-6:00', "value": 0 },
                        { "time": '11-25', "type": '6:00-7:00', "value": 0 },
                        { "time": '11-25', "type": '7:00-8:00', "value": 0 },
                        { "time": '11-25', "type": '8:00-9:00', "value": 0 },
                        { "time": '11-25', "type": '9:00-10:00', "value": 0 },
                        { "time": '11-25', "type": '10:00-11:00', "value": 0 },
                        { "time": '11-25', "type": '11:00-12:00', "value": 0 },
                        { "time": '11-25', "type": '12:00-13:00', "value": 0 },
                        { "time": '11-25', "type": '13:00-14:00', "value": 0 },
                        { "time": '11-25', "type": '14:00-15:00', "value": 0 },
                        { "time": '11-25', "type": '15:00-16:00', "value": 0 },
                        { "time": '11-25', "type": '16:00-17:00', "value": 0 },
                        { "time": '11-25', "type": '17:00-18:00', "value": 0 },
                        { "time": '11-25', "type": '18:00-19:00', "value": 0 },
                        { "time": '11-25', "type": '19:00-20:00', "value": 0 },
                        { "time": '11-25', "type": '20:00-21:00', "value": 0 },
                        { "time": '11-25', "type": '21:00-22:00', "value": 0 },
                        { "time": '11-25', "type": '22:00-23:00', "value": 0 },
                        { "time": '11-25', "type": '23:00-24:00', "value": 0 },
                        { "time": '11-26', "type": '0:00-1:00', "value": 0 },
                        { "time": '11-26', "type": '1:00-2:00', "value": 0 },
                        { "time": '11-26', "type": '2:00-3:00', "value": 0 },
                        { "time": '11-26', "type": '3:00-4:00', "value": 0 },
                        { "time": '11-26', "type": '4:00-5:00', "value": 0 },
                        { "time": '11-26', "type": '5:00-6:00', "value": 0 },
                        { "time": '11-26', "type": '6:00-7:00', "value": 0 },
                        { "time": '11-26', "type": '7:00-8:00', "value": 0 },
                        { "time": '11-26', "type": '8:00-9:00', "value": 0 },
                        { "time": '11-26', "type": '9:00-10:00', "value": 0 },
                        { "time": '11-26', "type": '10:00-11:00', "value": 0 },
                        { "time": '11-26', "type": '11:00-12:00', "value": 0 },
                        { "time": '11-26', "type": '12:00-13:00', "value": 0 },
                        { "time": '11-26', "type": '13:00-14:00', "value": 0 },
                        { "time": '11-26', "type": '14:00-15:00', "value": 0 },
                        { "time": '11-26', "type": '15:00-16:00', "value": 0 },
                        { "time": '11-26', "type": '16:00-17:00', "value": 0 },
                        { "time": '11-26', "type": '17:00-18:00', "value": 0 },
                        { "time": '11-26', "type": '18:00-19:00', "value": 0 },
                        { "time": '11-26', "type": '19:00-20:00', "value": 0 },
                        { "time": '11-26', "type": '20:00-21:00', "value": 0 },
                        { "time": '11-26', "type": '21:00-22:00', "value": 0 },
                        { "time": '11-26', "type": '22:00-23:00', "value": 0 },
                        { "time": '11-26', "type": '23:00-24:00', "value": 0 },
                        { "time": '11-27', "type": '0:00-1:00', "value": 0 },
                        { "time": '11-27', "type": '1:00-2:00', "value": 0 },
                        { "time": '11-27', "type": '2:00-3:00', "value": 0 },
                        { "time": '11-27', "type": '3:00-4:00', "value": 0 },
                        { "time": '11-27', "type": '4:00-5:00', "value": 0 },
                        { "time": '11-27', "type": '5:00-6:00', "value": 0 },
                        { "time": '11-27', "type": '6:00-7:00', "value": 0 },
                        { "time": '11-27', "type": '7:00-8:00', "value": 0 },
                        { "time": '11-27', "type": '8:00-9:00', "value": 0 },
                        { "time": '11-27', "type": '9:00-10:00', "value": 0 },
                        { "time": '11-27', "type": '10:00-11:00', "value": 0 },
                        { "time": '11-27', "type": '11:00-12:00', "value": 0 },
                        { "time": '11-27', "type": '12:00-13:00', "value": 0 },
                        { "time": '11-27', "type": '13:00-14:00', "value": 0 },
                        { "time": '11-27', "type": '14:00-15:00', "value": 0 },
                        { "time": '11-27', "type": '15:00-16:00', "value": 0 },
                        { "time": '11-27', "type": '16:00-17:00', "value": 0 },
                        { "time": '11-27', "type": '17:00-18:00', "value": 0 },
                        { "time": '11-27', "type": '18:00-19:00', "value": 0 },
                        { "time": '11-27', "type": '19:00-20:00', "value": 0 },
                        { "time": '11-27', "type": '20:00-21:00', "value": 0 },
                        { "time": '11-27', "type": '21:00-22:00', "value": 0 },
                        { "time": '11-27', "type": '22:00-23:00', "value": 0 },
                        { "time": '11-27', "type": '23:00-24:00', "value": 0 },
                        { "time": '11-28', "type": '1:00-2:00', "value": 0 },
                        { "time": '11-28', "type": '0:00-1:00', "value": 0 },
                        { "time": '11-28', "type": '2:00-3:00', "value": 0 },
                        { "time": '11-28', "type": '3:00-4:00', "value": 0 },
                        { "time": '11-28', "type": '4:00-5:00', "value": 0 },
                        { "time": '11-28', "type": '5:00-6:00', "value": 0 },
                        { "time": '11-28', "type": '6:00-7:00', "value": 0 },
                        { "time": '11-28', "type": '7:00-8:00', "value": 0 },
                        { "time": '11-28', "type": '8:00-9:00', "value": 0 },
                        { "time": '11-28', "type": '9:00-10:00', "value": 0 },
                        { "time": '11-28', "type": '10:00-11:00', "value": 0 },
                        { "time": '11-28', "type": '11:00-12:00', "value": 0 },
                        { "time": '11-28', "type": '12:00-13:00', "value": 0 },
                        { "time": '11-28', "type": '13:00-14:00', "value": 0 },
                        { "time": '11-28', "type": '14:00-15:00', "value": 0 },
                        { "time": '11-28', "type": '15:00-16:00', "value": 0 },
                        { "time": '11-28', "type": '16:00-17:00', "value": 0 },
                        { "time": '11-28', "type": '17:00-18:00', "value": 0 },
                        { "time": '11-28', "type": '18:00-19:00', "value": 0 },
                        { "time": '11-28', "type": '19:00-20:00', "value": 0 },
                        { "time": '11-28', "type": '20:00-21:00', "value": 0 },
                        { "time": '11-28', "type": '21:00-22:00', "value": 0 },
                        { "time": '11-28', "type": '22:00-23:00', "value": 0 },
                        { "time": '11-28', "type": '23:00-24:00', "value": 0 },
                    ];

                    for (let i = 0; i < jsonData.length; i++) {
                        let hour = parseInt(jsonData[i].time.substr(11, 2));
                        let date = jsonData[i].time.substr(5, 5)
                        if (date === '11-25') {
                            data[hour].value += 1;
                        } else if (date === '11-26') {
                            data[hour + 24].value += 1;
                        } else if (date === '11-27') {
                            data[hour + 48].value += 1;
                        } else if (date === '11-28') {
                            data[hour + 72].value += 1;
                        } else {
                            continue;
                        }
                    }
                    const chart = new G2.Chart({
                        container: 'container',
                        autoFit: true,
                        height: 500,
                    });
                    chart.data(data);
                    chart.scale('value', {
                        alias: '新闻发布数量'
                    });
                    chart.axis('type', {
                        tickLine: null,
                    });

                    chart.axis('value', {
                        label: {
                            formatter: text => {
                                return text.replace(/(\d)(?=(?:\d{3})+$)/g, '$1,');
                            }
                        },
                        title: {
                            offset: 80,
                            style: {
                                fill: '#aaaaaa'
                            },
                        }
                    });
                    chart.legend({
                        position: 'right',
                    });

                    chart.tooltip({
                        shared: true,
                        showMarkers: false,
                    });
                    chart.interaction('active-region');

                    chart
                        .interval()
                        .adjust('stack')
                        .position('type*value')
                        .color('time', ['#40a9ff', '#1890ff', '#096dd9', '#0050b3']);

                    chart.render();
                }
            }
        }
    </script>
</body>

</html>